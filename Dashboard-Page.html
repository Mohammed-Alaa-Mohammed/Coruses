<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="dash-page.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courses Page</title>
    
    <!-- إضافة Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="light-mode">

    <div class="header">
        <h1>Courses</h1>
        <button class="theme-toggle" onclick="toggleTheme()">🌙</button>
    </div>

    <!-- شريط البحث والفلترة -->
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="ابحث عن كورس..." oninput="filterCourses()">
        <select id="filterSelect" onchange="filterCourses()" style="width:190px;">
            <option value="all">الكل</option>
            <option value="free">مجاني</option>
            <option value="paid">مدفوع</option>
        </select>
    </div>

    <!-- قائمة الكورسات -->
    <div class="course-container" id="courseList">
        <!-- سيتم تحميل الكورسات ديناميكيًا هنا -->
    </div>

    <!-- نافذة الرسالة باستخدام Bootstrap -->
    <div class="modal fade" id="courseModal" tabindex="-1" aria-labelledby="courseModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="courseModalLabel">تأكيد بدء الكورس</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    هل تريد بدء الكورس؟
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">إلغاء</button>
                    <button type="button" class="btn btn-primary" id="confirmButton">مشاهدة الكورس</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // تحميل الكورسات من localStorage وعرضها
        function loadCourses(filteredCourses = null) {
            const courses = filteredCourses || JSON.parse(localStorage.getItem('courses')) || [];
            const courseContainer = document.getElementById('courseList');
            courseContainer.innerHTML = '';

            courses.forEach((course, index) => {
                const courseElement = document.createElement('div');
                courseElement.classList.add('course');
                const buttonText = course.isPaid ? 'إشترك الآن' : 'ابدأ الآن';
                const buttonClass = course.isPaid ? 'subscribe' : 'start';

                courseElement.innerHTML = `
                    <h2>${course.title}</h2>
                    <p>${course.description}</p>
                    ${course.isPaid ? `<p>السعر: ${course.price} ريال</p>` : ''}
                    <p>المقدم: ${course.instructor}</p>
                    <p>عدد الدروس: ${course.lessons}</p>
                    <button class="${buttonClass}" data-title="${course.title}" data-link="${course.link}" data-bs-toggle="modal" data-bs-target="#courseModal">${buttonText}</button>
                `;
                courseContainer.appendChild(courseElement);
            });

            // إضافة مستمع للأزرار
            document.querySelectorAll('.start').forEach(button => {
                button.addEventListener('click', (event) => {
                    const courseLink = event.target.getAttribute('data-link');
                    showCourseModal(courseLink);
                });
            });
        }

        // دالة لإظهار رسالة التأكيد
        function showCourseModal(courseLink) {
            const confirmButton = document.getElementById('confirmButton');
            confirmButton.onclick = function () {
                window.location.href = courseLink; // التحويل إلى الرابط المحدد
            };
        }

        // فلترة الكورسات حسب البحث والاختيار
        function filterCourses() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const filterSelect = document.getElementById('filterSelect').value;

            const courses = JSON.parse(localStorage.getItem('courses')) || [];
            const filteredCourses = courses.filter(course => {
                const matchesSearch = course.title.toLowerCase().includes(searchInput) ||
                                      course.description.toLowerCase().includes(searchInput);
                const matchesFilter = 
                    filterSelect === 'all' ||
                    (filterSelect === 'free' && !course.isPaid) ||
                    (filterSelect === 'paid' && course.isPaid);
                return matchesSearch && matchesFilter;
            });

            loadCourses(filteredCourses);
        }

        // تغيير وضع الإضاءة والظلام
        function toggleTheme() {
            const body = document.body;
            const currentMode = body.classList.contains('light-mode') ? 'light' : 'dark';
            body.classList.remove(`${currentMode}-mode`);
            body.classList.add(`${currentMode === 'light' ? 'dark' : 'light'}-mode`);
            document.querySelector('.theme-toggle').textContent = currentMode === 'light' ? '☀️' : '🌙';
        }

        // تحميل الكورسات عند فتح الصفحة
        window.onload = () => {
            loadCourses();
        };
    </script>

    <!-- إضافة Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>